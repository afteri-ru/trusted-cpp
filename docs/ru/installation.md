---
layout: default
title: Установка
lang: ru
---

# Руководство по установке

Это руководство поможет вам установить и настроить Trusted-CPP в вашей системе.

## Требования

Перед установкой Trusted-CPP убедитесь, что у вас установлены следующие компоненты:

- Компилятор C++, поддерживающий C++20 (рекомендуется clang++ 20 или выше)
- CMake 3.12 или выше
- Git (для клонирования репозитория)

## Сборка из исходного кода

1. Клонируйте репозиторий:
```bash
git clone https://github.com/afteri-ru/trusted-cpp.git
cd trusted-cpp
```

2. Создайте каталог для сборки и перейдите в него:
```bash
mkdir build
cd build
```

3. Настройте проект с помощью CMake:
```bash
cmake ..
```

4. Соберите проект:
```bash
make
```

Это соберет как плагин Clang (`memsafe_clang.so`), так и исполняемый файл для тестов.

## Использование плагина

После сборки вы можете использовать плагин с clang++ для анализа вашего кода на C++:

```bash
clang++ -std=c++20 -Xclang -load -Xclang ./memsafe_clang.so -Xclang -add-plugin -Xclang memsafe -Xclang -plugin-arg-memsafe -Xclang circleref-disable ваш_файл.cpp
```

Замените `ваш_файл.cpp` на путь к вашему исходному файлу C++.

## Параметры плагина

Плагин поддерживает несколько аргументов командной строки:

- `--circleref-disable`: Отключить анализ циклических ссылок (по умолчанию)
- `--circleref-write`: Записать информацию о классах для анализа циклических ссылок (первый проход)
- `--circleref-read`: Прочитать информацию о классах для анализа циклических ссылок (второй проход)

Для анализа циклических ссылок необходимо запустить плагин дважды:
1. Первый проход с `--circleref-write` для сбора информации о классах
2. Второй проход с `--circleref-read` для выполнения анализа

Пример анализа циклических ссылок:
```bash
# Первый проход
clang++ -std=c++20 -Xclang -load -Xclang ./memsafe_clang.so -Xclang -add-plugin -Xclang memsafe -Xclang -plugin-arg-memsafe -Xclang circleref-write -fsyntax-only ваш_файл.cpp

# Второй проход
clang++ -std=c++20 -Xclang -load -Xclang ./memsafe_clang.so -Xclang -add-plugin -Xclang memsafe -Xclang -plugin-arg-memsafe -Xclang circleref-read ваш_файл.cpp
```

## Использование библиотеки

Включите заголовочный файл `memsafe.h` в ваши файлы C++ для использования возможностей библиотеки:

```cpp
#include "memsafe.h"

// Ваш код здесь
```

Библиотека в виде заголовочных файлов предоставляет расширенные типы умных указателей и механизмы потоковой безопасности.

## Запуск тестов

Для запуска тестов соберите исполняемый файл для тестов и запустите его:

```bash
./memsafe_test
```

Это выполнит все модульные тесты для библиотеки и плагина Trusted-CPP.
